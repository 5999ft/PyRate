PyRate
======
PyRate is a collection of Python 2 scripts for estimating the average rate (velocity) and incremental time-series of surface movement for every pixel in a stack of images generated by interferometric processing of Synthetic Aperture Radar (InSAR) data. PyRate is a partial Python translation of [Ï€-RATE](http://homepages.see.leeds.ac.uk/~earhw/software/pirate/), a MATLAB tool developed at the University of Leeds.

## Dependencies:
- [SciPy](www.scipy.org)
- [GDAL](www.gdal.org)
- [NetworkX](https://pypi.python.org/pypi/networkx)
- [pyproj](https://pypi.python.org/pypi/pyproj)
- [nose](https://pypi.python.org/pypi/nose/) unit testing framework
- [pytest](https://pypi.python.org/pypi/pytest)
- [sphinx](http://sphinx-doc.org/) for generating documentation
- [luigi](https://pypi.python.org/pypi/luigi) for controlling batch jobs
- [parmap](https://pypi.python.org/pypi/parmap/1.2.0) a python multiprocessing wrapper.

For the viewer you will also need:

- [Flask](http://flask.pocoo.org/)
- [Pillow](https://pypi.python.org/pypi/Pillow)
- [netCDF4](https://pypi.python.org/pypi/netCDF4)

## Setup GitHub credentials
### For rhe-compute1 and NCI (SSH authentication)
- Follow the instructions here: <https://help.github.com/articles/generating-an-ssh-key/>
- If you want to use ssh authentication on NCI your ssh key _must_ be password protected

### For other (HTTPS authentication)
- Login to GitHub and navigate to <https://github.com/settings/tokens> and click "Generate a new token"
- Give your token a description and check off repo, gist and user (so all the sub-check boxes are also checked off)
- When you click "Generate token" a large alphanumeric string will given which you will use as your password when cloning the repo
- You will not be able to see this password again after navigating away from the page, so ensure it is saved somewhere

## UNIX-based systems installation instructions (assuming SSH authentication)
PyRate and the Python environment (Anaconda) is best installed in the user's home directory and is assumed so in the following instructions.

### Clone the repo (requires SSH credentials)
    cd ~
    git clone git@github.com:GeoscienceAustralia/PyRate.git

### If using rhe-compute1...
PyRate needs a few environment variables set in order to run. Proxies also need to be set in order to download the environment. Since this needs to be done each time you open a terminal, it is best to put these lines in your startup script. By default, rhe-compute1 doesn't provide such scripts, but you can create them by:

    cp ~/Pyrate/.profile ~/
    cp ~/Pyrate/.bashrc ~/

Your new startup script is .bashrc in your home directory, and most of the environment variables have been set. If you need to install PyRate on a different system ensure all the variables listed in .bashrc are set correctly.

The only thing you need to change in .bashrc is to put in your username and password for the proxy. Change the lines:

    export http_proxy="http://<username>:<password>@proxy.ga.gov.au:8080"
    export https_proxy="http://<username>:<password>@proxy.ga.gov.au:8080"
    
eg...

    export http_proxy="http://myusername:mypassword@proxy.ga.gov.au:8080"
    export https_proxy="http://myusername:mypassword@proxy.ga.gov.au:8080"

### Create the run environment with Anaconda
Anaconda is a Python distribution which easily installs and manages Python modules.

- Download the latest Linux 64-bit Python 2.7 installer from [here](https://www.continuum.io/downloads) to your home directory
- `bash Anaconda2-2.4.1-Linux-x86_64.sh` in your home directory
- Please accept all defaults. This will install anaconda in the `~/anaconda2` directory
- Select yes when asked about "adding to path"
- `source ~/.bashrc`
- `source activate anaconda2/`
- `conda install -c conda conda-env` (update the base Anaconda modules)
- `conda env create -f ~/PyRate/environment.yml` (downloads the module set required by Pyrate)
- `source activate pyrate` (activates the above module set, consider adding the line to your .bashrc if it's the only environment you use)

### Test the installation
To run the tests, use the following command inside the `~/PyRate` directory:

    cd ~/PyRate
    nosetests --nologcapture --exe

#### In the advent of "ERROR: Failure: ImportError (libcom_err.so.3: cannot open shared object file: No such file or directory)"...
You haven't got a required shared library installed.

Get GNU Bison (required on rhe-compute for build, may not need on raijin, Wikipedia usually shows the latest stable version).

    cd ~
    wget http://ftp.gnu.org/gnu/bison/bison-3.0.4.tar.gz
    tar -xvzf bison-3.0.4.tar.gz
    mkdir bison_inst
    cd bison-3.0.4/
    ./configure --prefix=/nas/users/<usernamehere>/unix/bison_inst      TODO: can use $HOME instead?
    make
    make install
    echo 'export PATH=$HOME"/bison_inst/bin":$PATH' >> ~/.bashrc

Get Kerberos (stable at time of writing is 5-1.14)

    cd ~
    wget http://web.mit.edu/kerberos/dist/krb5/1.14/krb5-1.14.tar.gz
    tar xvf krb5-1.14.tar.gz
    cd krb5-1.14/
    cd src/
    ./configure
    mkdir ~/krb_inst
    make
    make install DESTDIR=/nas/users/<username>/unix/krb_inst    TODO: shell var again
    echo 'export LD_LIBRARY_PATH=$HOME"/krb_inst/usr/local/lib:$PATH"' >> ~/.bashrc