# PyRate - a Python tool for RAte and Time-series Estimation

PyRate is a Python tool for estimating the rate (velocity) and time-series of surface movement for every pixel in a stack of images generated by interferometric processing of Synthetic Aperture Radar (InSAR) data. PyRate is a partial Python port of [Pirate](http://homepages.see.leeds.ac.uk/~earhw/software/pi-rate/) (Poly-Interferogram Rate And Time-Series Estimator), a MATLAB tool developed by the University of Leeds.


## Dependencies:

- [SciPy](www.scipy.org)
- [GDAL](www.gdal.org)
- [NetworkX](https://pypi.python.org/pypi/networkx)
- [pyproj](https://pypi.python.org/pypi/pyproj)
- [nose](https://pypi.python.org/pypi/nose/)
- [pytest](https://pypi.python.org/pypi/pytest)
- [sphinx](http://sphinx-doc.org/) for building the docs.

For the viewer you will also need

- [Flask](http://flask.pocoo.org/)
- [Pillow](https://pypi.python.org/pypi/Pillow)
- [netCDF4](https://pypi.python.org/pypi/netCDF4)
- and if your working on the NCI, you will have to install a web browser.


## Installation

Currently this application does not require any installation. You need to add the directory containing the *pyrate* folder to the *PYTHONPATH* environment variable.


## Documentation

The [Sphinx](http://sphinx-doc.org/) documenation of the scripts can be found under the main documentation tree for the project, which is found in the top level folder *doc*. To build the documentation do

	apidoc
	make html

The documentation will be generated in *doc/build*. The main entry point is *index.html*.


## Tests

Tests use [unittest](http://pythontesting.net/framework/unittest/unittest-introduction/) and can be found in *pyrate/tests*.

To run the tests you need to get a copy of the test data from the NCI at */g/data1/dg9/PyRate_Project/data/*. There are several version of the data there found in date stamped zip files... you should probably use the most recent. The environment variable *PYRATEPATH* needs to point to the folder where you put the test data. 


## Basic Usage Instructions

The runnable programs can be found in *pyrate/scripts*.

The steps are:

1. Data formatting
1. TODO: configuration options? (edit the config file)
1. Image transformations
1. PyRate workflow


### Data formatting:

The utility scripts *gamma.py* & *roipac.py* are provided to convert geocoded unwrapped interferograms in ROI_PAC or GAMMA format into a GeoTIFF format usable by PyRate.

For command line options/help:

	python <full_path>/gamma.py -h

or

	python <full_path>/roipac.py -h

A GAMMA translation needs a geographic DEM header file (\*.dem.par) and SLC parameter files (\*.slc.par) for both master and slave images to extract metadata required for the formatting. Therefore three header files are needed to format each geocoded unwrapped GAMMA interferogram <GAMMA_FILE>. Only the DEM header file is given on the command line - the SLC parameter files are located automatically in the same location as the interfergram file by date string pattern matching.

	python <full_path>/gamma.py [OPTIONS] <*.dem.par> <GAMMA_FILE>


A ROI\_PAC translation requires a header/resource file (*.rsc* extension) for the geocoded unwrapped ROI_PAC interferogram (in the same directory) and either the geographic projection (e.g. 'WGS84') specified as an option or a header/resource file for the geographic DEM containing the geographic projection in the parameter DATUM:

	python <full_path>/roipac.py -p WGS84 <ROIPAC_FILE>

OR

	python <full_path>/roipac.py -r <*.dem.rsc> <ROIPAC_FILE>

Image transformations:
This separate step of multi-looking (resampling) and cropping the images is handled with *run_prepifg.py*.

For command line options/help:

	python <full_path>/run_prepifg.py -h

The *run_prepifg.py* script requires the PyRate runtime configuration file. If a config file is not provided as an arg, the script will look for 'pyrate.conf' in the current directory.  


PyRate workflow:
This is the core of the processing tools, handled with run_pyrate.py.

For command line options/help:


	python <full_path>/run_pyrate.py -h


The *run_pyrate.py* script also requires the PyRate runtime configuration file. As with the previous step, if a config file is not provided as an arg, the script will look for *pyrate.conf* by default.


### Running the viewer

You run the viewer from *pyrate/viewer/web.py" and passing the directory containing the (geotif) files you want to look at as the first command line parameter. For example:

	python pyrate/viewer/web.py /path/to/tifs

The program looks for a file *test.ncdf* (specified by `pyrate.viewer.datamanager.IMAGE_STACK_FILE_NAME`) in */path/to/tifs* and if it cannot find it, it will create it from all the *.tif files in that directory. It will create (or overwrite) the file *na_frequency.png* at the same time.

These two files will remain once the program exits and **WILL NOT BE AUTOMATICALLY RECREATED IF THE TIFF FILES CHANGE**. That is, one must manually remove *test.ncdf* to cause recreation of it.

## Todos

- NCI/GA contact details
- description of what the software does
- Licensing information
