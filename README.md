[![Build Status](https://travis-ci.org/GeoscienceAustralia/PyRate.svg?branch=master)](https://travis-ci.org/GeoscienceAustralia/PyRate)
[![Coverage Status](https://coveralls.io/repos/github/GeoscienceAustralia/PyRate/badge.svg?branch=master)](https://coveralls.io/github/GeoscienceAustralia/PyRate?branch=master)
[![Updates](https://pyup.io/repos/github/geoscienceaustralia/pyrate/shield.svg)](https://pyup.io/repos/github/geoscienceaustralia/pyrate/)
[![Python 3](https://pyup.io/repos/github/geoscienceaustralia/pyrate/python-3-shield.svg)](https://pyup.io/repos/github/geoscienceaustralia/pyrate/)
   
   
# PyRate - a Python tool for RAte and Time-series Estimation

PyRate is a Python tool for estimating the average rate (velocity) and 
incremental time-series of surface movement for every pixel in a stack of 
images generated by interferometric processing of Synthetic Aperture Radar 
(InSAR) data. PyRate is a partial Python translation of 
[Pirate](http://homepages.see.leeds.ac.uk/~earhw/software/pirate/), 
a MATLAB tool developed at the University of Leeds.

# Quickstart

Before you start, make sure your system has the following packages installed,

    sudo apt-get install gdal-bin libgdal-dev libpng12-dev libblas-dev liblapack-dev libatlas-dev libatlas-base-dev gfortran libproj-dev openmpi-bin libopenmpi-dev netcdf-bin libnetcdf11 libnetcdf-dev


We strongly recommend using a [`virtualenv`](https://gist.github.com/basaks/b33ea9106c7d1d72ac3a79fdcea430eb).

One might need to install a slightly older `python-daemon` to install `PyRate`:
    
    pip install python-daemon==2.1.1

To install, simply run ``setup.py``:

    python setup.py install

or install with ``pip``:

    pip install git+https://github.com/GeoscienceAustralia/PyRate

The python requirements should automatically be built and installed.


## Anaconda setup for `PyRate`

For anaconda installation and `virtualenv` instruction, [see this guide](conda.md). 

## Tests

Tests use [pytest](http://doc.pytest.org/en/latest/) and can be found in *tests*.

To run the tests, use the following command inside the `PyRate` directory:
		
	pip install pytest
	cd PyRate
	pytest tests/

## Config file:

TODO

## PyRate workflow:

### Preparing interferrograms: prepifg
The first step of PyRate is to convert the unwrapped interforrograms into 
geotiffs, followed by multilooking and cropping. Both of these operations are 
performed by the following command:
 
    pyrate prepifg /path/to/config_file
    
The two major steps during the `prepifg` operation are described below.

#### Data formatting: convert to geotiff

The `prepifg` command will determine the input format from the value specified 
at the *processor:* keyword in the config file (0: ROI\_PAC; 1: GAMMA)

A GAMMA translation requires a geographic DEM header file (\*.dem.par) and SLC parameter files (\*.slc.par) for both master and slave images to extract metadata required for the formatting. Therefore three header files are needed to format each geocoded unwrapped GAMMA interferogram <GAMMA_FILE>. The path and name of the DEM header file are specified in the config file under the *demHeaderFile:* keyword. The SLC parameter files should be in the same location as the interferogram file and are found automatically by date string pattern matching.

A ROI\_PAC translation requires a header/resource file (*.rsc* extension) for the geocoded unwrapped ROI_PAC interferogram (in the same directory) and either the geographic projection (e.g. 'WGS84') specified as an option or a header/resource file for the geographic DEM containing the geographic projection in the parameter DATUM:

#### Image transformations: multilooking and cropping
This `prepifg` command will also perform multi-looking (resampling) and 
cropping the images.
     
Two examples of the config files are provided in `configs` directory, 
with examples of the `roipac` and `gamma` prepifg configuration. 
Both config files can be used with `prepifg`.  
 
### Linear rate and time series analysis: linrate

This is the core of the processing tools, handled by the `linrate` command:
    
    pyrate linrate path/to/config_file

### Running the viewer

You run the viewer from *pyrate/viewer/web.py" and passing the directory containing the (geotif) files you want to look at as the first command line parameter. For example:

	python pyrate/viewer/web.py /path/to/tifs

The program looks for a file *test.ncdf* (specified by `pyrate.viewer.datamanager.IMAGE_STACK_FILE_NAME`) in */path/to/tifs* and if it cannot find it, it will create it from all the files with the tif extension in that directory. It will create (or overwrite) the file *na_frequency.png* at the same time.

These two files will remain once the program exits and **WILL NOT BE AUTOMATICALLY RECREATED IF THE TIFF FILES CHANGE**. That is, one must manually remove *test.ncdf* to cause recreation of it.

## Integrating PyAPS with PyRate

TODO

